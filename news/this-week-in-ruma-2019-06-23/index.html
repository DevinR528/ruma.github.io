<!DOCTYPE html>
<html>
<head>
<meta content='IE=edge' http_equiv='X-UA-Compatible'>
<meta charset='utf-8'>
<meta content='width=device-width,initial-scale=1' name='viewport'>
<link href='/images/apple-touch-icon-57x57-4fdb8100.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-114x114-0ba5c2b3.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='/images/apple-touch-icon-72x72-d9371b56.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-144x144-bd467b10.png' rel='apple-touch-icon-precomposed' sizes='144x144'>
<link href='/images/apple-touch-icon-60x60-9165d8af.png' rel='apple-touch-icon-precomposed' sizes='60x60'>
<link href='/images/apple-touch-icon-120x120-63f5f0ae.png' rel='apple-touch-icon-precomposed' sizes='120x120'>
<link href='/images/apple-touch-icon-76x76-1025d1ab.png' rel='apple-touch-icon-precomposed' sizes='76x76'>
<link href='/images/apple-touch-icon-152x152-a2a52576.png' rel='apple-touch-icon-precomposed' sizes='152x152'>
<link href='/images/favicon-196x196-0b47bb9f.png' rel='icon' sizes='196x196' type='image/png'>
<link href='/images/favicon-96x96-d739a671.png' rel='icon' sizes='96x96' type='image/png'>
<link href='/images/favicon-32x32-77e1cfca.png' rel='icon' sizes='32x32' type='image/png'>
<link href='/images/favicon-16x16-4aa60318.png' rel='icon' sizes='16x16' type='image/png'>
<link href='/images/favicon-128-6e4707f8.png' rel='icon' sizes='128x128' type='image/png'>
<meta content='Ruma' name='application-name'>
<meta content='#FFFFFF' name='msapplication-TileColor'>
<meta content='/images/mstile-144x144-bd467b10.png' name='msapplication-TileImage'>
<meta content='/images/mstile-70x70-6e4707f8.png' name='msapplication-square70x70logo'>
<meta content='/images/mstile-150x150-d5f0b5e6.png' name='msapplication-square150x150logo'>
<meta content='/images/mstile-310x150-e8749e81.png' name='msapplication-wide310x150logo'>
<meta content='/images/mstile-310x310-ed20b880.png' name='msapplication-square310x310logo'>
<title>This Week in Ruma</title>
<meta content='Ruma is a collection of Matrix applications and libraries written in the Rust programming language.' name='description'>
<link href='https://www.ruma.io/news/this-week-in-ruma-2019-06-23/' rel='canonical'>
<link href='/news/feed.atom' rel='alternate' type='application/atom+xml'>
<link href="/stylesheets/site-21a986c4.css" rel="stylesheet" />
</head>
<body class='news news_this-week-in-ruma-2019-06-23 news_this-week-in-ruma-2019-06-23_index'>
<nav class='navbar navbar-inverse navbar-static-top'>
<div class='container-fluid'>
<ul class='nav navbar-nav navbar-right'>
<li><a href="/" title="Home">Home</a></li>
<li><a href="/news/" title="News">News</a></li>
<li><a href="/status/" title="Project Status">Project Status</a></li>
<li><a href="/projects/" title="Projects">Projects</a></li>
<li><a href="/contributing/" title="How to Contribute">How to Contribute</a></li>
<li><a href="https://liberapay.com/ruma/" title="Donate to Ruma">Donate on Liberapay</a></li>
<li><a href="/docs/" title="Documentation">Documentation</a></li>
</ul>
</div>
</nav>

<div class='container'>
<div class='row'>
<div class='col-md-8 col-md-offset-2'>
<article class='ruma-news' itemscope itemtype='http://schema.org/BlogPosting'>
<meta content='Jimmy Cuadra' itemprop='author'>
<header>
<h1 itemprop='headline'>
<a href="/news/this-week-in-ruma-2019-06-23/" title="This Week in Ruma">This Week in Ruma</a>
<small itemprop='datePublished' value='2019-06-23'>June 23, 2019</small>
</h1>
<p>
<small>by Jimmy Cuadra</small>
</p>
<p>
<strong>Ruma</strong> is a <a href="https://matrix.org">Matrix</a> homeserver, client, and supporting libraries written in the <a href="https://www.rust-lang.org/">Rust</a> programming language. Matrix is an open specification for an online communication protocol. For an overview of the project, visit the <a href="/">home page</a>.
<strong>This Week in Ruma</strong> is a weekly summary of the development of Ruma, published on Sunday nights.
</p>
</header>
<h2 id="from-the-editor">From the editor</h2>

<p>This week was spent working on a big revamp of <a href="https://github.com/ruma/ruma-events">ruma-events</a>, the library that defines Rust types for the "events" used in Matrix.
The previous week, I did a pass through the entire library to bring it up to date with version r0.5.0 of the Matrix specification.</p>

<p>After some discussion in <a href="https://matrix.to/#/#ruma:matrix.org">#ruma:matrix.org</a>, I decided to make a move towards treating ruma-events as a higher-level library.
Previously, ruma-events has more or less offered Rust types that are exact representations of the JSON structures used by Matrix.
However, by representing events this way, it would be possible for users to easily create values that, while valid JSON, would be invalid events according to the specification.</p>

<p>The way we're approaching this problem is by separating serialization/deserialization of JSON from validation of events.
Rather than directly implementing <code>serde::Deserialize</code>, event types will be converted from a string of JSON data using <code>std::str::FromStr</code>.
This implementation will deserialize the data internally and then validate it, returning either a valid event, or a raw <code>serde_json::Value</code> along with an error message about why the event was invalid.
The latter form is necessary because invalid events will always be present in the Matrix system, created via bugs or other problems in homeserver implementations.
Once an event is in the event graph, other servers will receive these invalid events over federation, and must still persist them and deal with them as they are.</p>

<p>Similar to the new interface around deserialization, the serialized form of an event created by ruma-events may not directly match the structure of the Rust type.
ruma-events will instead expose variants of each event to ensure they can only be created in valid states.</p>

<p>To reduce the boilerplate that this approach necessarily causes (because for many events there will now be two structures: the public one and the private one used for converting to and from JSON), I started a new procedural macro, <a href="https://github.com/ruma/ruma-events-macros">ruma-events-macros</a>, to make the most common cases require minimal code in ruma-events.
It's been a lot of work, and there's still probably another week or more to go to finish implementing ruma-events using the new approach.
But when it's done, the result will be a Rust library for Matrix events that leaves less room for users to accidentally do the wrong thing, while also supporting interoperation with other Matrix software that isn't so strict.</p>

</article>

</div>
</div>
</div>

<footer class='ruma-footer'>
<div class='container-fluid'>
<ul class='nav'>
<li><a href="https://github.com/ruma">GitHub</a></li>
<li><a href="https://twitter.com/ruma_io">Twitter</a></li>
<li><a href="https://matrix.to/#/#ruma:matrix.org">Matrix room</a></li>
</ul>
</div>
</footer>
<div class='container-fluid'>
<p class='text-center'>
<small>
The source code and content of this website are free and available under the MIT license:
<a href="https://github.com/ruma/www.ruma.io">www.ruma.io</a>
</small>
</p>
</div>
</body>
</html>
