<!DOCTYPE html>
<html>
<head>
<meta content='IE=edge' http_equiv='X-UA-Compatible'>
<meta charset='utf-8'>
<meta content='width=device-width,initial-scale=1' name='viewport'>
<link href='/images/apple-touch-icon-57x57-4fdb8100.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-114x114-0ba5c2b3.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='/images/apple-touch-icon-72x72-d9371b56.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-144x144-bd467b10.png' rel='apple-touch-icon-precomposed' sizes='144x144'>
<link href='/images/apple-touch-icon-60x60-9165d8af.png' rel='apple-touch-icon-precomposed' sizes='60x60'>
<link href='/images/apple-touch-icon-120x120-63f5f0ae.png' rel='apple-touch-icon-precomposed' sizes='120x120'>
<link href='/images/apple-touch-icon-76x76-1025d1ab.png' rel='apple-touch-icon-precomposed' sizes='76x76'>
<link href='/images/apple-touch-icon-152x152-a2a52576.png' rel='apple-touch-icon-precomposed' sizes='152x152'>
<link href='/images/favicon-196x196-0b47bb9f.png' rel='icon' sizes='196x196' type='image/png'>
<link href='/images/favicon-96x96-d739a671.png' rel='icon' sizes='96x96' type='image/png'>
<link href='/images/favicon-32x32-77e1cfca.png' rel='icon' sizes='32x32' type='image/png'>
<link href='/images/favicon-16x16-4aa60318.png' rel='icon' sizes='16x16' type='image/png'>
<link href='/images/favicon-128-6e4707f8.png' rel='icon' sizes='128x128' type='image/png'>
<meta content='Ruma' name='application-name'>
<meta content='#FFFFFF' name='msapplication-TileColor'>
<meta content='/images/mstile-144x144-bd467b10.png' name='msapplication-TileImage'>
<meta content='/images/mstile-70x70-6e4707f8.png' name='msapplication-square70x70logo'>
<meta content='/images/mstile-150x150-d5f0b5e6.png' name='msapplication-square150x150logo'>
<meta content='/images/mstile-310x150-e8749e81.png' name='msapplication-wide310x150logo'>
<meta content='/images/mstile-310x310-ed20b880.png' name='msapplication-square310x310logo'>
<title>This Week in Ruma</title>
<meta content='Ruma is a set of Rust library crates for working with the Matrix protocol.' name='description'>
<link href='https://www.ruma.io/news/page/14/' rel='canonical'>
<link href='/news/feed.atom' rel='alternate' type='application/atom+xml'>
<link href="/stylesheets/site-21a986c4.css" rel="stylesheet" />
</head>
<body class='news news_page news_page_14 news_page_14_index'>
<nav class='navbar navbar-inverse navbar-static-top'>
<div class='container-fluid'>
<ul class='nav navbar-nav navbar-right'>
<li><a href="/" title="Home">Home</a></li>
<li><a href="/news/" title="News">News</a></li>
<li><a href="/projects/" title="Projects">Projects</a></li>
<li><a href="/contributing/" title="How to Contribute">How to Contribute</a></li>
<li><a href="https://liberapay.com/ruma/" title="Donate to Ruma">Donate on Liberapay</a></li>
<li><a href="/docs/" title="Documentation">Documentation</a></li>
</ul>
</div>
</nav>

<div class='container'>
<div class='row'>
<div class='col-md-8 col-md-offset-2'>
<article class='ruma-news' itemscope itemtype='http://schema.org/BlogPosting'>
<meta content='Jimmy Cuadra' itemprop='author'>
<header>
<h1 itemprop='headline'>
<a href="/news/this-week-in-ruma-2016-05-15/" title="This Week in Ruma">This Week in Ruma</a>
<small itemprop='datePublished' value='2016-05-15'>May 15, 2016</small>
</h1>
<p>
<small>by Jimmy Cuadra</small>
</p>
<p>
<strong>Ruma</strong> is a set of <a href="https://www.rust-lang.org/">Rust</a> library crates for working with the <a href="https://matrix.org">Matrix</a> protocol. Matrix is an open specification for an online communication protocol. For an overview of the project, visit the <a href="/">home page</a>.
<strong>This Week in Ruma</strong> is a weekly summary of the development of Ruma, published on Sunday nights.
</p>
</header>
<h2 id="from-the-editor">From the editor</h2>

<p>There were only a few commits this week, but there was very good progress on the test suite and some internals.
After trying several ways to work around libtest's lack of global setup and teardown hooks, and some issues with the way each test was running an Iron server in a thread keeping database connections open forever, I decided to move the setup and teardown outside of the Rust code itself.
I explored the code of libtest and libsyntax and got to understand how it works and some of its limitations.
I might be creating an RFC for Rust soon to give the programmer independent control of the test collector and the test runner, which are currently bound together under the <code>--test</code> flag (AKA <code>--cfg test</code>.)</p>

<p>Now the PostgreSQL Docker container is started and stopped, and database migraitons are run from a shell script which wraps <code>cargo test</code>.
The Iron app was similarly decoupled from the Iron server, so that integration testing can be done with <code>iron-test</code> without ever starting an actual server.
Finally, I made some more progress on Matrix's user-interactive authentication system and got part of the <code>/login</code> endpoint completed.
I expect it to be fully functional by next week.</p>

<h2 id="notable-changes-to-ruma">Notable changes to <code>ruma</code></h2>

<ul>
  <li>
    <p>Cleaned up test suite</p>

    <p>Complicated setup and teardown extracted from the Rust code.
Test cases moved into the modules they test, rather than within a <code>tests</code>-directory-style module in <code>src/test</code>.</p>
  </li>
  <li>
    <p>Introduced <code>iron-test</code> to facilitate testing</p>

    <p>The test suite now has a single support type, <code>test::Test</code>, which does per-test setup and teardown via RAII and provides succinct helper methods for making requests and testing the responses.</p>
  </li>
  <li>
    <p>Initial version of the <code>/login</code> API added.</p>

    <p>The logic is all there, but there are some places where deserialization of the types used in the request body must be manually implemented because they differ in structure from what Serde can do with its custom derive attributes.</p>
  </li>
</ul>

<h2 id="matrix-at-large">Matrix at large</h2>

<p>The sections about authentication, registration, and login in the spec have seen some very nice improvements recently, but there are still some parts that are misleading or unclear.
I'm in the process of getting a few things clarified that will help finally nail down how these various APIs should work.</p>

</article>

<article class='ruma-news' itemscope itemtype='http://schema.org/BlogPosting'>
<meta content='Jimmy Cuadra' itemprop='author'>
<header>
<h1 itemprop='headline'>
<a href="/news/this-week-in-ruma-2016-05-08/" title="This Week in Ruma">This Week in Ruma</a>
<small itemprop='datePublished' value='2016-05-08'>May 08, 2016</small>
</h1>
<p>
<small>by Jimmy Cuadra</small>
</p>
<p>
<strong>Ruma</strong> is a set of <a href="https://www.rust-lang.org/">Rust</a> library crates for working with the <a href="https://matrix.org">Matrix</a> protocol. Matrix is an open specification for an online communication protocol. For an overview of the project, visit the <a href="/">home page</a>.
<strong>This Week in Ruma</strong> is a weekly summary of the development of Ruma, published on Sunday nights.
</p>
</header>
<h2 id="from-the-editor">From the editor</h2>

<p>I'm back from my vacation to Montreal and Quebec City (which are lovely and you should visit) and working on Ruma again!
Although development this past week was hindered a bit by another round of breaking changes to the Rust compiler's <code>libsyntax</code> crate, which affects Ruma's use of <code>serde</code> and <code>diesel</code>, there have been a few changes to Ruma and some movement on the Matrix specification.</p>

<p>For anyone interested in following This Week in Ruma regularly, it is now available via an <a href="/news/feed.atom">Atom feed</a>.</p>

<h2 id="notable-changes-to-ruma">Notable changes to <code>ruma</code></h2>

<ul>
  <li>
    <p>New CLI subcommand, <code>ruma secret</code></p>

    <p>This new subcommand generates and prints a secure random value suitable as the <code>macaroon_secret_key</code> in the Ruma config file.
This value is used as the secret key for creating user access tokens using <a href="https://github.com/cryptosphere/rust-macaroons">Macaroons</a>.</p>
  </li>
  <li>
    <p>Interactive authentication removed from <code>/register</code></p>

    <p>At least for now, user registration will not require any sort of external credential verification.
This area of the spec is currently less stable, so implementing it will wait until it makes more sense.</p>
  </li>
  <li>
    <p>Simplified structure for crates, modules, and tests</p>

    <p>The integration tests have been moved into the <code>src</code> directory so that it's not necessary to split <code>ruma</code> into a binary and a library just so the integration tests can link to the library.
This makes Cargo.toml and various <code>cargo</code> commands simpler.</p>
  </li>
  <li>
    <p>Swagger data source</p>

    <p>By default, <code>ruma</code> now serves a JSON structure at <code>/ruma/swagger.json</code> that can be loaded by <a href="https://github.com/swagger-api/swagger-ui">Swagger UI</a> to display the full Matrix client-server specification that will eventually be implemented by Ruma.</p>
  </li>
</ul>

<h2 id="matrix-at-large">Matrix at large</h2>

<p>There has been a bunch of activity on the spec recently.
It appears that the Matrix team is preparing for a stable 1.0 release of the client-server API spec.
A branch I worked on for the spec landing page of the specification was also merged.
Those changes improve the organization of the information to make several things clearer to first-time readers.</p>

</article>

<article class='ruma-news' itemscope itemtype='http://schema.org/BlogPosting'>
<meta content='Jimmy Cuadra' itemprop='author'>
<header>
<h1 itemprop='headline'>
<a href="/news/this-week-in-ruma-2016-04-24/" title="This Week in Ruma">This Week in Ruma</a>
<small itemprop='datePublished' value='2016-04-24'>April 24, 2016</small>
</h1>
<p>
<small>by Jimmy Cuadra</small>
</p>
<p>
<strong>Ruma</strong> is a set of <a href="https://www.rust-lang.org/">Rust</a> library crates for working with the <a href="https://matrix.org">Matrix</a> protocol. Matrix is an open specification for an online communication protocol. For an overview of the project, visit the <a href="/">home page</a>.
<strong>This Week in Ruma</strong> is a weekly summary of the development of Ruma, published on Sunday nights.
</p>
</header>
<h2 id="from-the-editor">From the editor</h2>

<p>I said last week that there wouldn't be an update this week because I'm on vacation, but as it turns out a bit of progress was made before I left and I have a few minutes to make the update while my partner writes postcards to send back home.</p>

<h2 id="notable-changes-to-ruma">Notable changes to <code>ruma</code></h2>

<ul>
  <li>
    <p>Add initial stub implementation of user-interactive authentication.</p>

    <p>Matrix's interactive auth system is in a bit of a transition, so there has been lots of investigation and discussion with the core team to learn how it works.
I was able to make some good progress on how it will be represented as Rust code, but there are many more changes to come.
I hope to have "dummy" authentication working soon.</p>
  </li>
</ul>

<h2 id="matrix-at-large">Matrix at large</h2>

<p>Many of my questions about the specification have been answered, thanks to Richard van der Hoff of the Matrix core team.
A few issues are ongoing, but all of this discussion will be very helpful in improving the specification and clarifying some flows so that Ruma can implement them.</p>

<p>Specifically:</p>

<ul>
  <li>
    <p><a href="https://matrix.org/jira/browse/SPEC-385">SPEC-385</a>: PUT requests should use the JSON body for all request parameters</p>

    <p>Came to agreement that, at least for the <code>/register</code> API endpoint, request parameters related to the registration should not be split arbitrarily across the query string and the body of the request.</p>
  </li>
  <li>
    <p><a href="https://matrix.org/jira/browse/SPEC-343">SPEC-343</a>: Explain the purpose of refresh tokens</p>

    <p>Clarified why Matrix authentication involves both "access tokens" and "refresh tokens," where implementations are free to make their own choices, and the trade offs involved.</p>
  </li>
  <li>
    <p><a href="https://matrix.org/jira/browse/SPEC-313">SPEC-313</a>: Provide a high level overview of the different event syncing API endpoints</p>

    <p>Ongoing discussion of which APIs are used by the client to get events, and how best to update the spec to make recent API deprecations more clear.</p>
  </li>
  <li>
    <p><a href="https://matrix.org/jira/browse/SPEC-310">SPEC-310</a>: Consider renaming "state key" to "subtype" and making it optional</p>

    <p>Ongoing discussion of the semantics of Matrix's "state events," as well as discussion about how to balance the quality of the spec with the need to make progress on implementations.</p>
  </li>
  <li>
    <p><a href="https://matrix.org/jira/browse/SPEC-308">SPEC-308</a>: Authentication API is unclear/misleading</p>

    <p>Ongoing discussion about how the user-interactive authentication system relates to specific API endpoints that use it, like <code>/register</code> and <code>/login</code>.</p>
  </li>
</ul>

</article>

<nav>
<ul class='ruma-pagination'>
<li>
<span>&larr;</span>
<a href="/news/page/13/" rel="prev">Previous</a>
</li>
<li>Page 14</li>
<li>
<a href="/news/page/15/" rel="next">Next</a>
<span>&rarr;</span>
</li>
</ul>
</nav>
</div>
</div>
</div>

<footer class='ruma-footer'>
<div class='container-fluid'>
<ul class='nav'>
<li><a href="https://github.com/ruma">GitHub</a></li>
<li><a href="https://twitter.com/ruma_io">Twitter</a></li>
<li><a href="https://matrix.to/#/#ruma:matrix.org">Matrix room</a></li>
</ul>
</div>
</footer>
<div class='container-fluid'>
<p class='text-center'>
<small>
The source code and content of this website are free and available under the MIT license:
<a href="https://github.com/ruma/ruma.github.io">www.ruma.io</a>
</small>
</p>
</div>
</body>
</html>
